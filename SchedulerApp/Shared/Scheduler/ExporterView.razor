@namespace SchedulerApp.Shared.Scheduler
@using SchedulerApp.Modules
@using Data.Scheduler
@using System.Text;
@using System.Text.Json;

@using MudBlazor
@using Newtonsoft.Json

@inject IJSRuntime JS
@inject Exporter exporter

<div>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="_ => DownloadFileStream()">Download Problem as Json</MudButton>
</div>

@code {
    [Parameter]
    public ProblemScope ProblemScope { get; set; } = default!;

    [Parameter]
    public EventCallback<ProblemScope> OnProblemScopeChanged { get; set; }

    private bool ErrorDisplayed = false;

    private string ErrorMessage = "";

    private async Task DownloadFileStream()
    {
        var stream = new MemoryStream(Encoding.UTF8.GetBytes(JsonConvert.SerializeObject(ProblemScope)));
        using var streamref = new DotNetStreamReference(stream: stream);
        await JS.InvokeVoidAsync("downloadFileFromStream", "scheduling-problem.json", streamref);
    }
}
