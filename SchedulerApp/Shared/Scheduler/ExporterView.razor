@namespace SchedulerApp.Shared.Scheduler
@using SchedulerApp.Modules
@using Data.Scheduler
@using System.Text;
@using System.Text.Json;

@using MudBlazor
@using Newtonsoft.Json

@inject IJSRuntime JS
@inject Exporter exporter

<div>
    <h1 class="text-lg m-3">
        Download Options
    </h1>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="rounded-lg" OnClick="_ => DownloadFileStream()">CSV</MudButton>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="rounded-lg" OnClick="_ => DownloadFileStream()">XLSX</MudButton>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="rounded-lg" OnClick="_ => DownloadFileStream()">GDOC</MudButton>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="rounded-lg" OnClick="_ => DownloadFileStream()">Json</MudButton>
</div>

@code {
    [Parameter]
    public ProblemScope ProblemScope { get; set; } = default!;

    [Parameter]
    public EventCallback<ProblemScope> OnProblemScopeChanged { get; set; }

    private async Task DownloadFileStream()
    {
        var stream = new MemoryStream(Encoding.UTF8.GetBytes(JsonConvert.SerializeObject(ProblemScope)));
        using var streamref = new DotNetStreamReference(stream: stream);
        await JS.InvokeVoidAsync("downloadFileFromStream", "scheduling-problem.json", streamref);
    }
}
